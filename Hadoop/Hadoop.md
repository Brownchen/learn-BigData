# Hadoop



### 分布式文件存储系统——HDFS
HDFS是Hadoop下的分布式文件系统，具有高容错、高吞吐量等特性，可以部署在低成本的硬件上。

构建于单个磁盘之上的一般文件系统，会将文件划分为文件块，并将这些文件块存储到磁盘块上（文件块大小是磁盘块的整数倍）。

而HDFS中也有这种**[数据块](# HDFS中使用数据块的好处)**（block）的概念。**集群中的所有硬件设备都会被分为block，而文件则会被分为块大小的多个分块(chunk)，这些分块被保存为多个副本存储在集群中的多个节点中**。HDFS的block一般比较大（128M），这是为了**最小化寻址开销**，这样传输一个由多个块组成的大文件的时间主要取决于磁盘的传输速率。

#### 1、HDFS设计原理
<img src="https://camo.githubusercontent.com/9004fba74875e356ebe692fa949cf5ea888b13ac/68747470733a2f2f67697465652e636f6d2f68656962616979696e672f426967446174612d4e6f7465732f7261772f6d61737465722f70696374757265732f686466736172636869746563747572652e706e67" alt="img" style="zoom:67%;" />

##### 1.1 HDFS架构
HDFS遵循主/从架构，即一个namenode(NN)和多个datanode(DN):

- **namenode**：管理**文件系统的命名空间**，维护着文件系统树以及整棵树内所有文件和目录，例如打开、关闭、重命名文件和目录等操作。这些信息以：**命名空间镜像文件**和**编辑日志文件**的形式永久保存在本地磁盘中。另外，namenode记录着每个文件中各个块所在的数据节点信息。
- **datanode**：是文件系统的工作节点。它们根据需要**存储并检索数据块**（一般是受客户端或namenode的调度），并且定期向namenode发送他们所存储的数据块列表。



##### 1.2 文件系统命名空间

HDFS的文件系统命名空间的层次结构与大多数文件系统类似（如Linux），支持目录和文件的创建、移动、删除和重命名等操作，支持配置用户和访问权限，但**不支持[硬链接和软链接](# Linux的硬链接与软链接)**。



##### 1.3 数据复制

由于Hadoop被设计运行在廉价的机器上，这意味着硬件是不可靠的，因此，为了保证容错性，HDFS提供了数据复制机制。HDFS将每个文件存储为一系列**块**，每个块有多个副本来保证容错，块的大小和复制因子可以自行配置（默认情况下，块大小是128M，复制因子是3）。

<img src="https://camo.githubusercontent.com/51a81b63b3eda1956dfe79ca4523806114e11852/68747470733a2f2f67697465652e636f6d2f68656962616979696e672f426967446174612d4e6f7465732f7261772f6d61737465722f70696374757265732f68646673646174616e6f6465732e706e67" alt="img" style="zoom:67%;" />

##### 1.4 数据复制的实现原理

大型的HDFS实例常常部署在多个机架上的多台服务器上，不同机架上的两台服务器通过交换机进行通讯。通常情况下，同一机架上的服务器间的网络带宽大于不同机架上服务器之间的的带宽。因此，HDFS采用**机架感知副本放置策略**，常见情况下，复制因子为3时：

写入程序位于datanode上时，优先将写入文件的一个副本放在该datanode上，否则随机放在随机datanode上。之后在另一个远程机架上的任意一个节点上存放另一个副本，并在该机架上的另一个节点上放置最后一个副本。此策略可以减少机架之间的写入流量，从而提高写入性能。


![img](https://camo.githubusercontent.com/13a6efeb0f206fb5bceae8b1fbfe5756f70ee0a4/68747470733a2f2f67697465652e636f6d2f68656962616979696e672f426967446174612d4e6f7465732f7261772f6d61737465722f70696374757265732f686466732de69cbae69eb62e706e67)

##### 1.5 副本的选择

##### 1.6 架构的稳定性

- 心跳机制和重新复制
- 数据的完整性
- 元数据的磁盘故障
FsImage和EditLog
- 支持快照

#### 2、HDFS的特点
##### 2.1 高容错
##### 2.2 高吞吐量
##### 2.3 大文件支持
##### 2.4 简单一致性模型
##### 2.5 跨平台移植性



# 参考

## Linux的硬链接与软链接

## HDFS中使用数据块的好处

对分布式文件系统中的块进行抽象会带来很多好处。

- 一个文件的大小可以大于网络中任意一个磁盘的容量，组成文件的所有数据块可以被分散在集群中的多个磁盘上；
- 使用数据块作为存储单元，大大简化了存储子系统的设计。由于数据块的大小是固定的，可以很容易知道单个磁盘能存储多少个块。且数据块只需要存储大块的数据，而文件的元数据可以单独存储，方便管理；
- 每个块可以备份到多个地方，保证了文件系统的容错性和数据的完整性。